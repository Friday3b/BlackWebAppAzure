@* @model IEnumerable<heseninTaski_Ecommerce.Models.Product> *@

@* <h2>Product List</h2> *@

@* <a href="/Product/Create" class="btn btn-success mb-3">Create New Product</a> *@

@* <table class="table"> *@
@*     <thead> *@
@*         <tr> *@
@*             <th>Name</th> *@
@*             <th>Description</th> *@
@*             <th>Slug</th> *@
@*             <th>Price</th> *@
@*             <th>CreatedBy</th> *@
@*             <th>Actions</th> *@
@*         </tr> *@
@*     </thead> *@
@*     <tbody> *@
@*         @foreach (var product in Model) *@
@*         { *@
@*             <tr> *@
@*                 <td>@product.Name</td> *@
@*                 <td>@product.Description</td> *@
@*                 <td>@product.Slug</td> *@
@*                 <td>@product.Price</td> *@
@*                 <td>@product.CreatedBy</td> *@
@*                 <td> *@
@*                     <a href="/Product/Edit/@product.Id" class="btn btn-warning btn-sm">Edit</a> *@
@*                     <a href="/Product/Delete/@product.Id" class="btn btn-danger btn-sm" onclick="return confirm('Əminsən?');">Delete</a> *@
@*                 </td> *@
@*             </tr> *@
@*         } *@
@*     </tbody> *@
@* </table> *@


@* @model IEnumerable<heseninTaski_Ecommerce.Models.Product> *@

@* <h2 class="text-center my-5">Product List</h2> *@

@* <div class="container"> *@
@*     <div class="row justify-content-center"> *@
@*         <div class="col-md-10"> *@
@*             <div class="card shadow-lg"> *@
@*                 <div class="card-body"> *@
@*                     <a href="/Product/Create" class="btn btn-success mb-3">Create New Product</a> *@

@*                     <table class="table table-striped table-bordered"> *@
@*                         <thead class="thead-dark"> *@
@*                             <tr> *@
@*                                 <th>Name</th> *@
@*                                 <th>Description</th> *@
@*                                 <th>Slug</th> *@
@*                                 <th>Price</th> *@
@*                                 <th>CreatedBy</th> *@
@*                                 <th>Actions</th> *@
@*                             </tr> *@
@*                         </thead> *@
@*                         <tbody> *@
@*                             @foreach (var product in Model) *@
@*                             { *@
@*                                 <tr> *@
@*                                     <td>@product.Name</td> *@
@*                                     <td>@product.Description</td> *@
@*                                     <td>@product.Slug</td> *@
@*                                     <td>@product.Price</td> *@
@*                                     <td>@product.CreatedBy</td> *@
@*                                     <td> *@
@*                                         <a href="/Product/Edit/@product.Id" class="btn btn-warning btn-sm mr-2">Edit</a> *@
@*                                         <a href="/Product/Delete/@product.Id" class="btn btn-danger btn-sm" onclick="return confirm('Əminsən?');">Delete</a> *@
@*                                     </td> *@
@*                                 </tr> *@
@*                             } *@
@*                         </tbody> *@
@*                     </table> *@
@*                 </div> *@
@*             </div> *@
@*         </div> *@
@*     </div> *@
@* </div> *@




@* @model IEnumerable<heseninTaski_Ecommerce.Models.Product> *@

@* <h2 class="text-center my-5">Product List</h2> *@

@* <div class="container"> *@
@*     <div class="row justify-content-center"> *@
@*         <div class="col-md-10"> *@
@*             <div class="card shadow-lg"> *@
@*                 <div class="card-body"> *@
@*                     <a href="/Product/Create" class="btn btn-success mb-3">Create New Product</a> *@

@*                     <table class="table table-striped table-bordered"> *@
@*                         <thead class="thead-dark"> *@
@*                             <tr> *@
@*                                 <th>Name</th> *@
@*                                 <th>Description</th> *@
@*                                 <th>Slug</th> *@
@*                                 <th>Price</th> *@
@*                                 <th>CreatedBy</th> *@
@*                                 <th>Actions</th> *@
@*                                 <th>Add to Cart</th> <!-- Yeni sütun əlavə edilir --> *@
@*                             </tr> *@
@*                         </thead> *@
@*                         <tbody> *@
@*                             @foreach (var product in Model) *@
@*                             { *@
@*                                 <tr> *@
@*                                     <td>@product.Name</td> *@
@*                                     <td>@product.Description</td> *@
@*                                     <td>@product.Slug</td> *@
@*                                     <td>@product.Price</td> *@
@*                                     <td>@product.CreatedBy</td> *@
@*                                     <td> *@
@*                                         <a href="/Product/Edit/@product.Id" class="btn btn-warning btn-sm mr-2">Edit</a> *@
@*                                         <a href="/Product/Delete/@product.Id" class="btn btn-danger btn-sm" onclick="return confirm('Əminsən?');">Delete</a> *@
@*                                     </td> *@
@*                                     <td> *@
@*                                         <!-- Add to Cart düyməsi --> *@
@*                                         <form action="/Product/AddToCart" method="post"> *@
@*                                             <input type="hidden" name="productId" value="@product.Id" /> *@
@*                                             <button type="submit" class="btn btn-info btn-sm">Add to Cart</button> *@
@*                                         </form> *@
@*                                     </td> *@
@*                                 </tr> *@
@*                             } *@
@*                         </tbody> *@
@*                     </table> *@
@*                 </div> *@
@*             </div> *@
@*         </div> *@
@*     </div> *@
@* </div> *@


@* @model IEnumerable<heseninTaski_Ecommerce.Models.Product> *@

@* <h2 class="text-center my-5">Product List</h2> *@

@* <div class="container"> *@
@*     <div class="row justify-content-center"> *@
@*         <div class="col-md-10"> *@
@*             <div class="card shadow-lg"> *@
@*                 <div class="card-body"> *@
@*                     <a href="/Product/Create" class="btn btn-success mb-3">Create New Product</a> *@

@*                     <table class="table table-striped table-bordered"> *@
@*                         <thead class="thead-dark"> *@
@*                             <tr> *@
@*                                 <th>Name</th> *@
@*                                 <th>Description</th> *@
@*                                 <th>Slug</th> *@
@*                                 <th>Price</th> *@
@*                                 <th>CreatedBy</th> *@
@*                                 <th>Actions</th> *@
@*                                 <th>Add to Cart</th> *@
@*                             </tr> *@
@*                         </thead> *@
@*                         <tbody> *@
@*                             @foreach (var product in Model) *@
@*                             { *@
@*                                 <tr> *@
@*                                     <td>@product.Name</td> *@
@*                                     <td>@product.Description</td> *@
@*                                     <td>@product.Slug</td> *@
@*                                     <td>@product.Price</td> *@
@*                                     <td>@product.CreatedBy</td> *@
@*                                     <td> *@
@*                                         <a href="/Product/Edit/@product.Id" class="btn btn-warning btn-sm mr-2">Edit</a> *@
@*                                         <a href="/Product/Delete/@product.Id" class="btn btn-danger btn-sm" onclick="return confirm('Əminsən?');">Delete</a> *@
@*                                     </td> *@
@*                                     <td> *@
@*                                         <!-- Add to Cart düyməsi --> *@
@*                                         <button type="button" class="btn btn-info btn-sm" onclick="addToCart(@product.Id)">Add to Cart</button> *@
@*                                     </td> *@
@*                                 </tr> *@
@*                             } *@
@*                         </tbody> *@
@*                     </table> *@
@*                 </div> *@
@*             </div> *@
@*         </div> *@
@*     </div> *@
@* </div> *@

@* <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> *@

@* <script> *@
@*     // Add to Cart funksiyası *@
@*     function addToCart(productId) { *@
@*         $.ajax({ *@
@*             url: '/Product/AddToCart',  // Add to Cart action URL *@
@*             type: 'POST', *@
@*             data: { productId: productId }, *@
@*             success: function(response) { *@
@*                 alert('Product added to cart!'); *@
@*                 // İstəyirsinizsə, buradakı "Add to Cart" düyməsinin vəziyyətini dəyişə bilərsiniz. *@
@*             }, *@
@*             error: function(xhr, status, error) { *@
@*                 alert('Error occurred: ' + error); *@
@*             } *@
@*         }); *@
@*     } *@
@* </script> *@


@model IEnumerable<heseninTaski_Ecommerce.Models.Product>

<h2 class="text-center my-5">Product List</h2>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />


<!-- Səbət İkonu -->
<div class="container">
    <div class="row justify-content-end">
        <div class="col-md-2">
            <a href="/Cart/Index" class="btn btn-warning">
                <i class="fa fa-shopping-cart"></i> Cart (<span id="cartCount">0</span>)
            </a>
        </div>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow-lg">
                <div class="card-body">
                    <a href="/Product/Create" class="btn btn-success mb-3">Create New Product</a>

                    <table class="table table-striped table-bordered">
                        <thead class="thead-dark">
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Slug</th>
                                <th>Price</th>
                                <th>CreatedBy</th>
                                <th>Actions</th>
                                <th>Add to Cart</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var product in Model)
                            {
                                <tr>
                                    <td>@product.Name</td>
                                    <td>@product.Description</td>
                                    <td>@product.Slug</td>
                                    <td>@product.Price</td>
                                    <td>@product.CreatedBy</td>
                                    <td>
                                        <a href="/Product/Edit/@product.Id" class="btn btn-warning btn-sm mr-2">Edit</a>
                                        <a href="/Product/Delete/@product.Id" class="btn btn-danger btn-sm" onclick="return confirm('Əminsən?');">Delete</a>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-info btn-sm" onclick="addToCart(@product.Id)">Add to Cart</button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    // Add to Cart funksiyası
    function addToCart(productId) {
        $.ajax({
            url: '/Product/AddToCart',
            type: 'POST',
            data: { productId: productId },
            success: function(response) {
                if (response.success) {
                    alert(response.message);
                    // Səbət sayını yeniləyirik
                    $('#cartCount').text(response.cartCount);
                } else {
                    alert(response.message);
                }
            },
            error: function(xhr, status, error) {
                alert('Error occurred: ' + error);
            }
        });
    }
   
    function updateCartCount() {
        fetch('/Cart/GetCartCount')
            .then(response => response.json())
            .then(data => {
                document.getElementById('cart-count').innerText = data.count;
            })
            .catch(error => {
                console.error('Cart count error:', error);
            });
    }

    // Səhifə yüklənəndə çağır
    document.addEventListener("DOMContentLoaded", function () {
        updateCartCount();
    });





    // Səhifə yüklənəndə səbətin sayını yeniləyirik
    $(document).ready(function() {
        $.ajax({
            url: '/Cart/GetCartCount', // Səbətin sayını əldə etmək üçün controller metodunu çağırırıq
            type: 'GET',
            success: function(response) {
                $('#cartCount').text(response.cartCount);
            },
            error: function(xhr, status, error) {
                console.log('Error:', error);
            }
        });
    });

</script>
